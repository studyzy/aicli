<!--
同步影响报告
=============
版本更改: 1.0.0 (维持不变 - 确认性验证)
最后验证: 2026-01-12
理由: 用户确认项目需求与现有章程完全一致,无需修改

用户输入验证:
✅ Go 语言命令行工具 - 已覆盖(原则 I, II)
✅ AI 支持功能 - 已覆盖(原则 V)
✅ 中文文档和注释 - 已覆盖(原则 IV)
✅ 单元测试覆盖率 ≥60% - 已覆盖(原则 III)

修改的原则: 
- 无修改,所有原则保持不变

模板一致性验证:
✅ .specify/templates/plan-template.md - 章程检查部分与原则完全对齐
✅ .specify/templates/spec-template.md - 需求和成功标准对齐章程要求
✅ .specify/templates/tasks-template.md - 测试优先流程和覆盖率要求已体现
✅ .codebuddy/commands/speckit.*.md - 所有命令文档与章程一致

延迟项: 无
-->

# aicli 项目章程

## 核心原则

### I. 模块化库优先

每个功能都从独立的 Go 包(package)开始实现。每个包必须:
- 自包含且职责单一(遵循单一职责原则)
- 可独立测试(具备完整的单元测试)
- 有清晰的中文文档说明包的用途和使用方式
- 有明确的目的 - 不允许仅用于代码组织的空包

**理由**: 模块化设计提高代码可维护性和可复用性,便于团队协作和功能迭代。清晰的包边界有助于理解代码结构和依赖关系。

### II. 命令行接口优先

每个核心功能都通过 CLI 命令暴露。命令行接口必须遵循:
- **输入**: 支持命令行参数(flags)和标准输入(stdin)
- **输出**: 正常结果输出到标准输出(stdout),错误信息输出到标准错误(stderr)
- **格式**: 支持 JSON 格式和人类可读格式输出
- **退出码**: 正确使用退出码(0表示成功,非0表示错误)

**理由**: 标准化的 CLI 接口使工具易于集成到自动化脚本和 CI/CD 流水线中,提供灵活的使用方式。

### III. 测试优先(不可协商)

**必须遵循 TDD(测试驱动开发)流程**:
1. 编写测试用例(测试先行)
2. 获得用户/团队批准测试方案
3. 验证测试失败(红)
4. 实现功能代码使测试通过(绿)
5. 重构优化(重构)

**覆盖率要求(不可协商)**:
- 单元测试覆盖率必须达到 **60% 或以上**
- 核心业务逻辑包必须达到 **80% 或以上**
- 使用 `go test -cover` 验证覆盖率
- CI/CD 流水线必须强制检查覆盖率门禁

**理由**: 高测试覆盖率确保代码质量和可维护性,TDD 方法论确保设计的可测试性,减少后期 bug。测试覆盖率要求是质量红线,不可妥协。

### IV. 中文优先的文档与注释(不可协商)

**所有项目文档和代码注释必须使用中文**:

**代码注释要求**:
- 所有导出的(public)函数、类型、常量、变量必须有中文注释
- 注释遵循 Go 标准注释格式(godoc 格式)
- 复杂逻辑必须有行内注释说明
- 注释说明"为什么"而不仅是"是什么"

**文档要求**:
- README.md 必须包含中文项目说明、安装指南和快速开始
- 每个主要功能模块需要独立的中文文档
- API 文档必须中文化
- 使用示例必须配有中文说明

**理由**: 项目面向中文用户,中文文档和注释降低理解门槛,提高开发效率和用户体验。统一语言标准避免混乱。

### V. AI 集成规范

作为 AI 辅助的命令行工具,必须遵循:
- **API 抽象**: 将不同 AI 提供商的 API 抽象为统一接口
- **配置管理**: API 密钥和配置通过环境变量或配置文件管理,不得硬编码
- **错误处理**: 优雅处理 API 调用失败、超时、限流等情况
- **隐私保护**: 明确说明数据使用方式,不得未经授权上传敏感信息
- **可观测性**: 记录 AI 调用的关键信息(不包含敏感数据)用于调试

**理由**: 标准化的 AI 集成方式确保工具的可扩展性、安全性和用户信任。

## 代码质量标准

### 编码规范

- 严格遵循 Go 官方代码风格指南([Effective Go](https://golang.org/doc/effective_go))
- 使用 `gofmt` 格式化代码(强制)
- 使用 `golint` 或 `golangci-lint` 进行静态代码检查
- 变量、函数、类型命名使用英文,但注释使用中文

### 代码审查

- 所有代码必须经过 Pull Request 审查
- 至少需要 1 人审查通过才能合并
- 审查者必须验证:
  - 测试覆盖率达标
  - 中文注释完整
  - 代码符合架构设计
  - 无明显性能问题

### 依赖管理

- 使用 Go Modules 管理依赖
- 优先使用成熟稳定的第三方库
- 新增依赖必须评估必要性和维护状态
- 定期更新依赖以修复安全漏洞

## 文档与注释规范

### 项目级文档

**必须包含**:
- `README.md`: 项目介绍、功能特性、安装和使用说明(中文)
- `CONTRIBUTING.md`: 贡献指南,说明如何参与项目开发(中文)
- `docs/`: 详细的功能文档和架构设计文档(中文)

### 代码级注释

**godoc 格式示例**:
```go
// UserService 提供用户管理相关的业务逻辑。
// 包括用户创建、查询、更新和删除等操作。
type UserService struct {
    repo UserRepository
}

// CreateUser 创建新用户。
// 参数 name 为用户名,email 为邮箱地址。
// 返回创建的用户对象和可能的错误。
// 如果邮箱已存在,返回 ErrEmailExists 错误。
func (s *UserService) CreateUser(name, email string) (*User, error) {
    // 实现逻辑...
}
```

### 最佳实践

- 避免无意义的重复性注释
- 注释及时更新,与代码保持同步
- 复杂算法需配有中文说明和示例

## 治理

### 章程优先级

本章程是项目开发的最高指导原则,优先于所有其他实践和惯例。

### 修正流程

章程的修正需要:
1. 提交书面修正提案,说明修改原因和影响范围
2. 团队讨论并达成共识
3. 更新章程文档并递增版本号
4. 更新相关模板和指导文档
5. 如涉及破坏性变更,制定迁移计划

### 合规验证

- 所有 Pull Request 必须验证是否符合本章程
- Code Review 必须检查测试覆盖率和中文注释
- 复杂性增加必须有充分理由和文档说明
- CI/CD 流水线强制执行覆盖率和代码规范检查

### 指导文档

- 运行时开发指导参考 `.specify/templates/` 中的模板文件
- 新功能开发必须先创建规范文档(使用 `/speckit.specify` 命令)
- 实施计划必须经过审查(使用 `/speckit.plan` 命令)

**版本**: 1.0.0 | **批准日期**: 2026-01-12 | **最后修正**: 2026-01-12

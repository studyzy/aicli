# 变更:添加国际化(i18n)支持

## 为什么

当前 aicli 所有用户界面文本、LLM 提示词、配置文件说明都使用中文硬编码,限制了国际用户的使用体验。为了让 aicli 更好地服务全球用户,需要实现国际化支持,根据用户操作系统语言自动适配界面语言。

**关键问题:**
- 非中文用户无法理解命令行输出和错误信息
- LLM 提示词使用中文可能影响某些场景下的命令生成质量
- 配置向导和帮助文档仅提供中文版本

## 变更内容

### 核心功能
- **语言检测**: 自动检测操作系统语言环境(LANG/LC_ALL 环境变量)
- **配置覆盖**: 支持在配置文件中手动指定语言偏好(`~/.aicli.json` 中增加 `language` 字段)
- **双语支持**: 初期支持中文(zh)和英文(en)两种语言

### 国际化范围
1. **用户界面文本**
   - CLI 输出信息(成功/失败/警告提示)
   - 错误信息和异常提示
   - 交互式确认提示(如危险命令确认)
   - 历史记录显示文本
   - 帮助信息和使用说明

2. **LLM 提示词**
   - 系统提示词(System Prompt)根据语言切换
   - 用户提示词构建时的模板文本
   - 执行上下文描述文本

3. **配置和文档**
   - 配置文件初始化向导(`aicli init`)的所有提示文本
   - 配置文件中的注释说明
   - CLI 帮助文档(`--help`)

### 技术实现要点
- 创建 `pkg/i18n` 包统一管理国际化资源
- 使用语言代码(zh/en)作为键索引翻译文本
- 轻量级实现,不引入重型 i18n 框架,避免增加二进制体积
- 支持运行时语言切换(通过配置文件)

## 影响

### 受影响规范
- **新增规范**: `i18n`(国际化核心功能)
- **修改规范**: `llm-prompt`(提示词国际化)
- **修改规范**: `cli-interface`(命令行界面国际化)

### 受影响代码
- `pkg/i18n/`: 新增国际化包
  - `i18n.go`: 核心语言检测和翻译功能
  - `messages_zh.go`: 中文翻译资源
  - `messages_en.go`: 英文翻译资源
- `pkg/llm/prompt.go`: 提示词国际化改造
- `cmd/aicli/main.go`: 主命令文本国际化
- `cmd/aicli/init.go`: 配置向导国际化
- `internal/app/app.go`: 应用逻辑层文本国际化
- `internal/app/confirm.go`: 确认提示国际化
- `pkg/config/config.go`: 配置结构增加 `Language` 字段
- `pkg/config/default.go`: 默认配置支持语言自动检测

### 不影响的部分
- 核心执行逻辑(`executor`, `safety` 等)
- LLM API 调用逻辑
- 历史记录存储格式(保持不变)
- 配置文件 JSON 结构(仅增加可选字段)

## 重大变更

**无重大变更** - 这是向后兼容的功能增强:
- 现有配置文件无需修改即可继续工作(自动检测语言)
- 用户可选择性地在配置中指定语言
- 默认行为:检测系统语言,中文环境下与当前行为一致

## 验收标准

- 中文系统环境下,默认显示中文(保持当前体验)
- 英文系统环境下,自动切换为英文
- 配置文件中设置 `"language": "en"` 后,强制使用英文
- 所有用户可见文本(CLI 输出、错误、提示)都已国际化
- LLM 提示词根据语言切换(中文环境用中文 prompt,英文环境用英文 prompt)
- 测试覆盖率保持 ≥60%
- 二进制体积增长 <100KB
